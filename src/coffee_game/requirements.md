# コーヒーゲーム - 要件定義

## ゲーム概要
コーヒーの温度管理スキルを競うマネージメントゲーム。
複数のコーヒーメーカーを管理し、やってくるお客さんに最適な温度のコーヒーを提供して得点を稼ぐ。

## ゲームシステム

### 1. コーヒーメーカー（複数台）
- **初期状態**: オフ（温度 = 0℃）
- **操作**:
  - `Set`: コーヒー豆をセット → 加熱を開始
  - `Dispense`: コーヒーを出す（セットされているコーヒーを全て放出）
  - `Status`: 現在の温度と状態を確認
  
- **温度管理**:
  - 加熱速度: 毎ティック 5℃/秒（ゲームループの固定時間単位で増加）
  - 最高温度: 90℃（この温度に達するとセット状態を保つ）
  - 冷却速度: 毎ティック 1℃/秒（コーヒーをセットしていない状態で冷えていく）
  
- **評価**:
  - 理想温度: 70℃～80℃
  - 80℃～90℃: 高得点（ボーナス）
  - 70℃～80℃: 満点
  - 60℃～70℃: 標準得点
  - 50℃～60℃: 低得点
  - 50℃未満: 得点なし

### 2. お客さんシステム
- **到着**: ランダムな時間間隔（2～5秒）でお客さんが1人ずつ到着
- **行動**:
  - 到着時に列に追加
  - コーヒーメーカーが空いている（最後のお客さんに対応完了）ときに、列の最初のお客さんを対応
  - `Dispense` で提供されたコーヒーの温度に応じた得点を獲得
  - その後、列から退出
  
- **待機**: 列内で次番を待つ（店内にとどまらない＝列外では管理対象外）

### 3. スコアリングシステム
- **得点計算**:
  - コーヒーの温度が理想範囲に近いほど得点が高い
  - 温度ごとの得点:
    ```
    50℃未満      : 0 点
    50℃～60℃    : 20 点
    60℃～70℃    : 50 点
    70℃～80℃    : 100 点（満点）
    80℃～90℃    : 150 点（ボーナス）
    ```
  
- **累積スコア**: ゲーム開始からの合計得点を表示
- **ゲームタイム**: 経過時間を記録

### 4. ゲームループ
- **ティック**: 約 100ms～200ms の固定時間単位
- **各ティック処理**:
  1. お客さん到着判定（ランダムチェック）
  2. 各コーヒーメーカーの温度を更新（加熱 or 冷却）
  3. キー入力を処理（メーカー選択、アクション実行）
  4. UI をレンダリング（温度、列の状態、スコア等を表示）
  5. イベント（コーヒー提供完了、客退出等）を処理

### 5. UI 表示
- **メーカー情報**: 
  - 各メーカーの温度（℃）
  - セット状態（On/Off）
  - 現在のお客さん（名前またはID）の有無
  
- **列情報**: 
  - 待機中のお客さん数
  - 各お客さんの待機時間
  
- **スコア情報**:
  - 現在の総得点
  - 経過時間
  
- **操作ガイド**:
  - 1～N: メーカー選択
  - S: Set
  - D: Dispense
  - G: Status
  - Esc/Q: ゲーム終了

### 6. ゲーム終了
- **終了条件**:
  - プレイヤーが Esc または Q を押下
  - 一定時間（例: 5分）経過後
  
- **結果画面**:
  - 総得点
  - プレイ時間
  - メーカー別の平均温度提供度
  - 対応したお客さんの総数

## 実装の考慮事項

### アーキテクチャ
- **ゲーム状態管理**: `App` 構造体に統合
- **コーヒーメーカー**: `CoffeeMaker` 構造体（温度, 状態, 現客数）
- **お客さんキュー**: `VecDeque<Customer>` で管理
- **温度計算**: ティック毎に線形更新

### 乱数生成
- 客到着時間、最初の客到着タイミング等は `rand` クレートで生成

### 将来の拡張
- 複数お客さんの同時対応（マルチレーン）
- メーカーの故障、修理システム
- 特殊なコーヒー豆（異なる加熱速度）
- サウンドエフェクト
